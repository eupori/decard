# Decard 릴리즈 실행 계획서

> 작성일: 2026-02-28
> 근거: `docs/MONETIZATION_PLAN.md` Phase 0~4 로드맵
> 코드베이스 분석 완료 후 작성 (models.py, routes.py, card_service.py, 프론트 전 화면 확인)

---

## 현재 구현 상태 요약

### 이미 구현된 것 (활용 가능)
- **SRS 백엔드**: `CardReviewModel` 테이블, SM-2 알고리즘(`srs_service.py`), `POST /cards/{id}/review`, `GET /study/due`, `GET /study/stats` 모두 완성
- **SRS 프론트**: `StudyScreen`에 `srsMode` 파라미터, 4단계 평가 버튼(다시/어려움/좋음/쉬움), `ApiService.reviewCard`, `getDueCards`, `getStudyStats` 구현 완료
- **시험 모드**: `ExamScreen` + `ExamResultScreen` + `ExamHistoryService` 구현 완료 (객관식/주관식/혼합, AI 채점, 틀린 문제 재시험, 시험 기록)
- **AI 채점**: `grade_service.py` + `POST /cards/{id}/grade` + 프론트 채점 API 연동 완료
- **카카오 로그인**: OAuth 전체 플로우 동작 (JWT 7일, 디바이스 마이그레이션)
- **보관함**: 폴더 CRUD + 세션 저장/제거 완성
- **CSV 내보내기**: Anki 호환 TSV 다운로드 완성
- **공개 카드셋**: Explore 탭 (카테고리, 검색, 다운로드, 발행) 구현 완료

### 구현이 필요한 것
- **카드 양 증가**: 현재 MAX_CARDS=50, 페이지당 카드 수 제한 없음 (프롬프트에 명시적 지시 없음)
- **OX형 템플릿**: `TEMPLATE_INSTRUCTIONS`에 없음. generate 엔드포인트에서 허용 안 함
- **난이도 태그 프론트 노출**: 카드에 `tags` 필드 있고 `difficulty:easy|medium|hard` 형태로 저장됨, 프론트에서 표시/필터 없음
- **개인정보처리방침/이용약관**: 없음
- **무료 3회 제한**: 생성 횟수 카운터 없음, UserModel에 관련 필드 없음
- **인앱결제**: 전무
- **페이월 UI**: 없음
- **Google/Apple 로그인**: 목업 상태 (LoginScreen에 안내만)
- **학습 통계 프론트**: 백엔드 API 있으나 프론트에서 통계 화면 없음 (HomeScreen에 "복습할 카드" 배너 없음)
- **오늘의 복습 진입점**: HomeScreen에서 SRS 복습으로 가는 UI 경로 없음

---

## Phase 0: 품질 개선 (Week 1) -- 유료화 전제조건

### 목표
1회 생성의 체감 가치를 "돈 낼 만한" 수준으로 올린다. 30p PDF 기준 50~80장 카드 생성 + OX형 추가.

### 전제조건
없음 (최우선 착수)

---

### P0-1. 카드 양 증가 + 품질 검수 반복 시스템

| 항목 | 내용 |
|------|------|
| **파트** | BE |
| **수정 파일** | `back/app/card_service.py` |
| **의존성** | 없음 |
| **난이도** | 중간 |

#### A. 카드 양 증가 (프롬프트 + 상수)

| 변경 | 내용 |
|------|------|
| `MAX_CARDS` | 50 → 120 (line 234) |
| 프롬프트 수정 | `_build_system_prompt()` line 114~115: "페이지당 4~7장의 카드를 만드세요. 내용이 풍부한 페이지는 7장 이상도 가능합니다." |
| `CHUNK_SIZE` | 5 → 7 검토 (청크당 호출 횟수 감소, 비용 절감) |

#### B. 생성 후 품질 검수 시스템 (신규)

현재 문제: 프롬프트에 "자체 검수" 지시가 있지만, 실제로 검수 결과를 코드에서 검증하지 않음. AI가 부실한 카드를 생성해도 그대로 DB에 저장됨.

**검수 반복 로직 설계:**

```
[1차 생성] → [품질 검수] → 기준 충족? → YES → 완료
                              ↓ NO
                    [부적합 카드 제외 + 부족분 추가 생성 요청]
                              ↓
                    [2차 검수] → 기준 충족? → YES → 완료
                              ↓ NO
                    [부적합 카드 제외 + 부족분 추가 생성 요청]
                              ↓
                    [3차 검수] → 결과 확정 (더 이상 반복 안 함)
```

**구현 상세:**

| 단계 | 내용 |
|------|------|
| **1. 청크별 생성** | 기존 로직 유지 (5~7페이지 청크 → Claude 호출 → JSON 파싱) |
| **2. 품질 검수** | 생성된 카드 배열에 대해 검수 기준 적용 |
| **3. 부적합 카드 처리** | 기준 미달 카드 제외 (status="rejected"로 표시하되 삭제하지 않음) |
| **4. 부족분 추가 생성** | 목표 카드 수 대비 부족하면, 동일 청크 텍스트 + "이미 생성된 카드 목록" + "부족한 관점" 전달하여 추가 생성 |
| **5. 반복** | 최대 3회까지. 3회차 결과는 그대로 확정 |

**품질 검수 기준 (검수 프롬프트에 포함):**

```
아래 기준으로 각 카드를 판정하세요. 대부분의 카드는 통과해야 합니다.
제외는 명확한 결함이 있는 경우에만 하세요.

[PASS] 통과:
- 원문 근거와 사실적으로 일치
- 질문이 명확하고 답이 하나로 특정됨
- 시험에 출제할 만한 의미 있는 내용

[FAIL] 제외:
- 원문에 없는 내용을 지어냄 (환각)
- 답이 여러 개 가능한 모호한 질문
- 빈칸형에서 일반 조사/동사를 빈칸으로 만듦
- 다른 카드와 거의 동일한 중복 카드
- 근거(evidence)가 빈 문자열이거나 답과 무관

[판정 비율 가이드]
- 전체 카드의 80~95%가 PASS여야 정상입니다
- 50% 이상 FAIL이면 생성 프롬프트가 잘못된 것입니다
- FAIL 카드는 수정 가능하면 수정하고, 수정 불가면 제외합니다
```

**부족분 추가 생성 프롬프트:**

```
이전 생성에서 아래 카드들이 품질 기준 미달로 제외되었습니다.
현재 유효 카드: N장 / 목표: M장 (K장 부족)

## 제외된 카드와 사유:
{제외 카드 목록 + 사유}

## 이미 생성된 유효 카드:
{유효 카드 front 목록 — 중복 방지용}

위 텍스트에서 아직 다루지 않은 출제 포인트를 찾아
K장 이상의 추가 카드를 만들어주세요.
이미 생성된 카드와 중복되지 않도록 주의하세요.
```

**목표 카드 수 계산:**

```python
# 페이지 수 기반 목표 (최소 보장)
target_cards = max(
    len(pages) * 4,   # 페이지당 최소 4장
    20                  # 최소 20장
)
target_cards = min(target_cards, MAX_CARDS)  # 상한 120장
```

**주의사항:**
- 검수가 대부분의 카드를 제외시키면 안 됨 (80~95% 통과가 정상)
- 추가 생성 시 이미 있는 카드 목록을 전달하여 중복 방지
- 3회 반복 후에도 목표 미달이면 그대로 확정 (무한 루프 방지)
- 검수 Claude 호출은 생성과 별도 (Haiku 사용 가능 → 비용 절감)

| 설정값 | 값 | 비고 |
|--------|-----|------|
| `MAX_REVIEW_ROUNDS` | 3 | 최대 검수 반복 횟수 |
| `REVIEW_PASS_THRESHOLD` | 0.8 | 통과율 80% 이상이면 추가 생성 불필요 |
| `MIN_TARGET_CARDS` | 20 | 최소 목표 카드 수 |
| `MAX_CARDS` | 120 | 상한 |

**기존 구현 활용:** 청크 병렬 처리, recommend 판단, JSON 파싱/재시도 로직 모두 유지. 생성 후 검수 단계를 추가하는 구조

---

### P0-2. OX형 템플릿 추가

| 항목 | 내용 |
|------|------|
| **파트** | BE + FE |
| **수정 파일** | |
| | BE: `back/app/card_service.py` — `TEMPLATE_INSTRUCTIONS` dict에 `"ox"` 키 추가 |
| | BE: `back/app/routes.py` — `generate()` 엔드포인트의 template_type 허용 목록에 `"ox"` 추가 (line 49) |
| | FE: `front/lib/screens/home_screen.dart` — 템플릿 선택 UI에 "OX형" 옵션 추가 |
| **변경 내용** | |
| | 1. OX형 프롬프트 작성: "앞면: OX로 판별 가능한 진술문, 뒷면: O 또는 X + 근거 1문장" |
| | 2. generate 엔드포인트 validation에 `"ox"` 추가 |
| | 3. 홈 화면 템플릿 선택 ChoiceChip에 "OX형" 추가 |
| **의존성** | 없음 |
| **난이도** | 낮음 (프롬프트 추가 + validation 확장) |
| **주의** | OX형 카드는 StudyScreen에서 기존 플래시카드 UI로 학습 가능 (앞면=진술문, 뒷면=O/X+해설). 별도 UI 불필요 |

---

### P0-3. 개인정보처리방침 + 이용약관

| 항목 | 내용 |
|------|------|
| **파트** | 기타 + FE + INFRA |
| **수정 파일** | |
| | 신규: `back/static/privacy.html` — 개인정보처리방침 |
| | 신규: `back/static/terms.html` — 이용약관 |
| | `back/app/main.py` — StaticFiles 마운트 추가 (`/static`) |
| | `front/lib/screens/login_screen.dart` — 로그인 화면 하단에 약관 링크 추가 |
| | `front/lib/screens/home_screen.dart` — 이용가이드 바텀시트에 링크 추가 |
| **변경 내용** | |
| | 1. 개인정보처리방침 HTML 작성 (수집항목: 카카오 ID/닉네임/프로필이미지, 기기ID, 업로드 PDF 텍스트) |
| | 2. 이용약관 HTML 작성 (서비스 이용 규칙, 면책) |
| | 3. Google Play 등록 필수 요건 충족 |
| **의존성** | 없음 |
| **난이도** | 낮음 (법률 문서 작성은 템플릿 활용) |
| **주의** | Google Play 출시 전 반드시 완료 필요. 개인정보처리방침 URL은 스토어 등록 시 필수 |

---

### Phase 0 산출물

| 산출물 | 검증 방법 |
|--------|-----------|
| 30p PDF -> 50장 이상 카드 생성 | 실제 PDF 3개로 테스트 |
| OX형 템플릿으로 카드 생성 가능 | OX 선택 후 생성 테스트 |
| 개인정보처리방침/이용약관 URL 접근 가능 | 브라우저에서 /static/privacy.html 확인 |

---

## Phase 1: SRS + 핵심 루프 (Week 2~4)

### 목표
유저가 매일 돌아오는 핵심 루프 완성: 카드 생성 -> 학습 -> SRS 복습 -> 통계 확인. D7 리텐션 > 15% 달성.

### 전제조건
Phase 0 완료 (카드 품질 확보)

---

### P1-1. "오늘의 복습" 홈 배너 + SRS 진입점

| 항목 | 내용 |
|------|------|
| **파트** | FE |
| **수정 파일** | |
| | `front/lib/screens/home_screen.dart` — 홈 상단에 "오늘의 복습" 배너 추가 |
| | `front/lib/services/api_service.dart` — 기존 `getDueCards`, `getStudyStats` 활용 |
| **변경 내용** | |
| | 1. HomeScreen 진입 시 `getStudyStats()` 호출 -> `due_cards` 수 표시 |
| | 2. "복습할 카드 N장" 배너 카드: 탭하면 SRS 복습 진입 |
| | 3. SRS 복습 진입: `getDueCards()` 호출 -> StudyScreen(srsMode: true) |
| | 4. 복습 완료 후 홈 돌아오면 배너 갱신 |
| | 5. due_cards == 0이면 "오늘의 복습 완료!" 표시 |
| **의존성** | 없음 |
| **난이도** | 중간 |
| **기존 구현 활용** | `StudyScreen(srsMode: true)` 이미 SRS 4단계 평가 UI 완성. `ApiService.getDueCards`, `getStudyStats` 이미 구현 완료. 진입점만 만들면 됨 |

---

### P1-2. 학습 통계 화면

| 항목 | 내용 |
|------|------|
| **파트** | FE |
| **수정 파일** | |
| | 신규: `front/lib/screens/stats_screen.dart` — 학습 통계 화면 |
| | `front/lib/screens/home_screen.dart` — 통계 진입 버튼 추가 |
| | `front/lib/config/api_config.dart` — (이미 `studyStatsUrl` 있음, 변경 불필요) |
| **변경 내용** | |
| | 1. 통계 화면 구현: 오늘 복습 수, 마스터 카드 수, 연속 학습일(스트릭), 복습 대기 카드 |
| | 2. 기억률 그래프 (선택, 시험기간 패스 프리미엄 기능으로 분류 가능) |
| | 3. 홈 화면에서 통계 진입점 (아이콘 버튼 또는 배너 하단 링크) |
| **의존성** | P1-1 (홈 배너에서 통계로 연결) |
| **난이도** | 중간 |
| **기존 구현 활용** | `GET /study/stats` API 완성 (reviews_today, mastered_cards, streak_days, due_cards). 프론트 화면만 구현 |

---

### P1-3. 보관함 -> SRS 복습 연결

| 항목 | 내용 |
|------|------|
| **파트** | FE |
| **수정 파일** | |
| | `front/lib/screens/folder_detail_screen.dart` — 폴더별 "복습하기" 버튼 추가 |
| | `front/lib/screens/library_screen.dart` — 폴더 카드에 "복습 대기 N장" 표시 (선택적) |
| **변경 내용** | |
| | 1. 폴더 상세 화면에 "복습하기" 버튼 추가 |
| | 2. `getDueCards(folderId: xxx)` 호출 -> StudyScreen(srsMode: true) 진입 |
| | 3. 폴더별 복습 카드 수 표시 (folder_id 파라미터 이미 지원) |
| **의존성** | P1-1 |
| **난이도** | 낮음 |
| **기존 구현 활용** | `GET /study/due?folder_id=xxx` 이미 구현 완료. 버튼만 추가 |

---

### P1-4. 학습 완료 후 SRS 평가 자동 전환

| 항목 | 내용 |
|------|------|
| **파트** | FE |
| **수정 파일** | |
| | `front/lib/screens/review_screen.dart` — "학습하기" 버튼에 SRS 모드 옵션 추가 |
| **변경 내용** | |
| | 1. 학습 버튼 탭 시 "일반 학습" vs "SRS 복습" 선택 (또는 기본 SRS 모드로 전환) |
| | 2. 처음 학습하는 카드도 SRS 기록을 남기도록 유도 |
| **의존성** | P1-1 |
| **난이도** | 낮음 |
| **기존 구현 활용** | StudyScreen의 srsMode 파라미터, _buildRatingButtons, _handleRate 모두 완성 |

---

### Phase 1 산출물

| 산출물 | 검증 방법 |
|--------|-----------|
| 홈 화면 "오늘의 복습 N장" 배너 | 카드 학습 후 다음 날 배너 확인 |
| 학습 통계 화면 (오늘 복습/마스터/스트릭) | 통계 화면 진입 후 데이터 확인 |
| 폴더별 SRS 복습 진입 | 보관함 > 폴더 > 복습하기 |
| Go/No-Go: D7 리텐션 > 15% | 실제 유저 데이터 측정 |

---

## Phase 2: 결제 인프라 (Week 5~6)

### 목표
무료 3회 제한 + 생성권 인앱결제 인프라 완성. 페이월 UX 구현.

### 전제조건
Phase 1 완료 (SRS로 리텐션 확보), Go 기준 달성

---

### P2-1. 생성 카운터 + 무료 3회 제한 (백엔드)

| 항목 | 내용 |
|------|------|
| **파트** | BE |
| **수정 파일** | |
| | `back/app/models.py` — UserModel에 생성 관련 필드 추가 |
| | `back/app/routes.py` — `generate()` 엔드포인트에 생성 제한 로직 추가 |
| | `back/app/database.py` — 마이그레이션 (컬럼 추가) |
| | 신규: `back/app/billing_service.py` — 결제/생성권 관리 서비스 |
| **변경 내용** | |
| | 1. `UserModel`에 필드 추가: |
| |   - `free_generates_used` (Integer, default=0) — 이번 달 무료 생성 횟수 |
| |   - `free_generates_reset_at` (DateTime) — 무료 횟수 리셋 시점 |
| |   - `paid_generates_remaining` (Integer, default=0) — 유료 생성권 잔여 |
| |   - `pass_expires_at` (DateTime, nullable) — 시험기간 패스 만료일 |
| | 2. 신규 테이블 `PurchaseModel`: |
| |   - `id`, `user_id`, `product_id`, `purchase_token`, `amount`, `status`, `created_at` |
| | 3. `generate()` 엔드포인트 수정: |
| |   - 로그인 유저: `can_generate()` 체크 (무료 잔여 or 유료 잔여 or 패스 활성) |
| |   - 비로그인 유저: 기존 동작 유지 (제한 없음 — 로그인 유도) |
| |   - 생성 시 카운터 차감 |
| | 4. `billing_service.py`: |
| |   - `can_generate(user)` — 생성 가능 여부 + 잔여 횟수 반환 |
| |   - `consume_generate(user)` — 횟수 차감 |
| |   - `reset_monthly_free(user)` — 월간 무료 리셋 |
| |   - `add_generates(user, count)` — 생성권 추가 |
| | 5. 신규 API: `GET /api/v1/billing/status` — 무료 잔여, 유료 잔여, 패스 만료일 |
| **의존성** | 없음 |
| **난이도** | 중간 |
| **주의사항** | |
| | - 월간 리셋은 매달 1일 기준 (또는 첫 생성일 기준 30일) |
| | - 비로그인 유저는 제한 없이 유지 (로그인 후에만 제한 적용) -> 로그인 유도 효과 |
| | - 무료→유료 전환 시점을 정확히 기록 (분석용) |

---

### P2-2. 생성 상태 API + 프론트 잔여 횟수 표시

| 항목 | 내용 |
|------|------|
| **파트** | FE + BE |
| **수정 파일** | |
| | `front/lib/services/api_service.dart` — `getBillingStatus()` 추가 |
| | `front/lib/config/api_config.dart` — billing URL 추가 |
| | `front/lib/screens/home_screen.dart` — 잔여 횟수 표시 |
| **변경 내용** | |
| | 1. 홈 화면 PDF 업로드 영역 근처에 "이번 달 무료 N회 남음" 표시 |
| | 2. 생성 실행 전 잔여 확인 -> 0이면 페이월 표시 |
| | 3. 생성 후 잔여 횟수 갱신 |
| **의존성** | P2-1 |
| **난이도** | 낮음 |

---

### P2-3. Google Play 인앱결제 연동

| 항목 | 내용 |
|------|------|
| **파트** | FE + BE + INFRA |
| **수정 파일** | |
| | `front/pubspec.yaml` — `in_app_purchase` 패키지 추가 |
| | 신규: `front/lib/services/purchase_service.dart` — 인앱결제 관리 |
| | `back/app/routes.py` — `POST /api/v1/billing/verify-purchase` 추가 |
| | `back/app/billing_service.py` — Google Play 영수증 검증 로직 |
| **변경 내용** | |
| | 1. Google Play Console에 소모품(consumable) 상품 등록: |
| |   - `decard_starter_5` — 스타터 5회 (₩1,100) |
| |   - `decard_standard_15` — 스탠다드 15회 (₩4,900) |
| |   - `decard_pass_30` — 시험기간 패스 30일 (₩9,900) — 비소모품(subscription) |
| | 2. Flutter `in_app_purchase` 패키지로 결제 플로우 구현 |
| | 3. 결제 완료 -> 서버에 영수증 전송 -> 서버에서 Google Play API로 검증 -> 생성권 추가 |
| | 4. 시험기간 패스: `pass_expires_at` 설정 (구매일 + 30일) |
| **의존성** | P2-1 |
| **난이도** | 높음 |
| **주의사항** | |
| | - Google Play 개발자 계정 등록 필요 (₩25 일회성) |
| | - 영수증 검증은 서버 사이드 필수 (클라이언트 검증만으로는 우회 가능) |
| | - `google-cloud-billing` 또는 직접 REST API 사용 |
| | - 테스트 결제 환경 설정 (라이선스 테스트 계정) |

---

### P2-4. 페이월 UI + 결제 화면

| 항목 | 내용 |
|------|------|
| **파트** | FE |
| **수정 파일** | |
| | 신규: `front/lib/screens/paywall_screen.dart` — 결제 화면 |
| | 신규: `front/lib/widgets/paywall_banner.dart` — 소프트 페이월 배너 |
| | `front/lib/screens/home_screen.dart` — 페이월 배너 삽입 |
| **변경 내용** | |
| | 1. **소프트 페이월 배너** (인라인, 비차단형): |
| |   - 1회 소진: "이번 달 무료 생성 2회 남았어요" (정보 전달) |
| |   - 2회 소진: "마지막 1회! 스타터 5회 ₩1,100" (부드러운 권유) |
| |   - 3회 소진: "무료 생성을 모두 사용했습니다" + 결제 화면 유도 (액션 유도) |
| | 2. **결제 화면** (MONETIZATION_PLAN 7.4 디자인 참고): |
| |   - 스타터 5회 ₩1,100 (첫 결제 추천 뱃지) |
| |   - 스탠다드 15회 ₩4,900 (시험기간 추천 뱃지) |
| |   - 시험기간 패스 ₩9,900 (가장 많이 쓰는 분께 뱃지) |
| |   - 하단: "학습은 항상 무료 / 유효기간 없는 생성권" |
| | 3. 생성 버튼 탭 시 잔여 0이면 결제 화면으로 이동 |
| **의존성** | P2-1, P2-3 |
| **난이도** | 중간 |
| **주의사항** | |
| | - 전면 팝업 차단 금지 (Soft paywall 원칙) |
| | - 학습/SRS/CSV 내보내기는 절대 잠그지 않음 |
| | - 3종 템플릿(정의/빈칸/비교) 무료 유지 |

---

### P2-5. 내부 QA + 베타 테스터

| 항목 | 내용 |
|------|------|
| **파트** | 기타 |
| **수행 내용** | |
| | 1. 결제 테스트 (Google Play 라이선스 테스트 계정 10개) |
| | 2. 결제 플로우 E2E: 무료 소진 -> 페이월 -> 결제 -> 생성권 추가 -> 생성 성공 |
| | 3. 엣지케이스: 결제 중 앱 종료, 네트워크 끊김, 중복 결제 방지 |
| | 4. 월간 리셋 테스트 (시간 조작) |
| | 5. 시험기간 패스 만료 테스트 |
| **의존성** | P2-1 ~ P2-4 모두 완료 |
| **난이도** | 중간 |

---

### Phase 2 산출물

| 산출물 | 검증 방법 |
|--------|-----------|
| 무료 3회 제한 동작 | 4번째 생성 시 페이월 표시 |
| 생성권 구매 -> 생성 가능 | 결제 후 추가 생성 성공 |
| 시험기간 패스 -> 무제한 생성 | 패스 구매 후 제한 없이 생성 |
| 페이월 UX 3단계 (정보/권유/액션) | 소진 단계별 배너 확인 |

---

## Phase 3: 소프트 런칭 (Week 7~8)

### 목표
Google Play 출시 + 에브리타임 마케팅 시작. 첫 유료 전환 달성.

### 전제조건
Phase 2 완료 (결제 인프라 + QA), Go 기준: 유료 전환율 > 5%

---

### P3-1. Google Play Store 등록

| 항목 | 내용 |
|------|------|
| **파트** | INFRA |
| **수행 내용** | |
| | 1. Google Play Console에 앱 등록 |
| |   - 앱 이름: "데카드 - PDF 시험 대비 암기카드" |
| |   - 짧은 설명: "PDF 올리면 시험카드가 자동으로! AI가 만드는 암기카드" |
| |   - 긴 설명: 기능 소개 + 차별점 |
| |   - 스크린샷 5장 이상 (홈/생성중/카드/학습/시험) |
| |   - 512x512 아이콘, 1024x500 그래픽 이미지 |
| | 2. 콘텐츠 등급 설정 (IARC) |
| | 3. 개인정보처리방침 URL 등록 (P0-3에서 생성한 URL) |
| | 4. 인앱 상품 등록 확인 (P2-3에서 생성) |
| | 5. 프로덕션 릴리스 트랙에 APK/AAB 업로드 |
| **수정 파일** | |
| | `front/android/app/build.gradle` — versionCode/versionName 업데이트 |
| | `front/android/app/src/main/AndroidManifest.xml` — release 설정 확인 |
| **의존성** | P0-3 (개인정보처리방침), P2-3 (인앱 상품) |
| **난이도** | 중간 (심사 과정 1~7일 소요) |
| **주의사항** | |
| | - AAB(Android App Bundle) 형태 권장 (APK 대비 크기 감소) |
| | - `flutter build appbundle --release` |
| | - 서명 키스토어 안전하게 보관 (분실 시 업데이트 불가) |

---

### P3-2. 에브리타임 마케팅

| 항목 | 내용 |
|------|------|
| **파트** | 기타 (마케팅) |
| **수행 내용** | |
| | 1. 에브리타임 게시판 5~10개 대학 타겟 게시글 |
| | 2. 콘텐츠: "교수 PPT 200장 -> 5분 만에 시험카드 50장" 사용법 |
| | 3. 다운로드 링크: Google Play URL |
| | 4. 피드백 채널: 카카오 오픈채팅 URL |
| **의존성** | P3-1 (스토어 출시 완료) |
| **난이도** | 낮음 |

---

### P3-3. 모니터링 + 분석 설정

| 항목 | 내용 |
|------|------|
| **파트** | BE + INFRA |
| **수정 파일** | |
| | `back/app/routes.py` — 전환 이벤트 로깅 추가 |
| | 신규: `back/app/analytics.py` — 핵심 지표 추적 (선택적) |
| **변경 내용** | |
| | 1. 핵심 지표 로깅: |
| |   - DAU/WAU/MAU (유니크 API 호출자) |
| |   - 생성 횟수 (무료/유료 구분) |
| |   - 유료 전환 이벤트 (상품별) |
| |   - D1/D7 리텐션 (SRS 복습 기준) |
| | 2. Slack 알림 추가: |
| |   - 첫 유료 전환 시 알림 |
| |   - 일일 요약 (생성 수, 유료 전환 수, 매출) |
| | 3. 기존 `/health` 엔드포인트에 통계 추가 |
| **의존성** | P2-1 (생성 카운터 데이터) |
| **난이도** | 중간 |

---

### P3-4. 피드백 수집 + 대응

| 항목 | 내용 |
|------|------|
| **파트** | 기타 |
| **수행 내용** | |
| | 1. 카카오 오픈채팅 생성 + URL 교체 (현재 TODO_PLACEHOLDER) |
| | 2. 피드백 분류: 버그 / 기능 요청 / 품질 불만 |
| | 3. 크리티컬 버그 즉시 대응 (핫픽스) |
| **수정 파일** | |
| | `front/lib/screens/home_screen.dart` — 오픈채팅 URL 교체 (기존 PLACEHOLDER) |
| **의존성** | P3-1 |
| **난이도** | 낮음 |

---

### Phase 3 산출물

| 산출물 | 검증 방법 |
|--------|-----------|
| Google Play 스토어 라이브 | 스토어에서 검색/설치 가능 |
| 에브리타임 게시글 5개 이상 | 게시글 URL 확인 |
| 유료 전환 1건 이상 | 결제 로그 확인 |
| Go/No-Go: 유료 전환율 > 5% | W8 기준 측정 |

---

## Phase 4: 시험기간 패스 + 성장 (Week 9~13)

### 목표
시험기간 패스(₩9,900) 출시 + Google/Apple 로그인 + 4월 중간고사 마케팅 집중.

### 전제조건
Phase 3 Go 기준 달성 (MAU > 200, 유료 > 15명)

---

### P4-1. 시험 모드 완성 (프리미엄 기능 해금)

| 항목 | 내용 |
|------|------|
| **파트** | FE + BE |
| **수정 파일** | |
| | `front/lib/screens/exam_screen.dart` — (이미 완성, 접근 제한만 추가) |
| | `front/lib/screens/review_screen.dart` — 시험 모드 버튼에 패스 체크 추가 |
| | `back/app/routes.py` — 시험 모드 접근 시 패스 확인 API (또는 billing/status에 포함) |
| **변경 내용** | |
| | 1. 시험 모드를 시험기간 패스 전용으로 게이트: |
| |   - 패스 미보유 시: 시험 버튼 탭 -> "시험 모드는 시험기간 패스에 포함된 기능입니다" + 결제 화면 유도 |
| |   - 패스 보유 시: 기존대로 ExamScreen 진입 |
| | 2. 결제 상태에 따라 버튼 UI 분기 (자물쇠 아이콘 등) |
| **의존성** | P2-1 (billing_service), P2-3 (인앱결제) |
| **난이도** | 낮음 |
| **기존 구현 활용** | ExamScreen, ExamResultScreen, ExamHistoryService 전부 완성 상태. 시험 설정 바텀시트, 객관식/주관식 생성, AI 채점, 틀린 문제 재시험, SRS 기록 모두 동작. 접근 제한만 추가하면 됨 |

---

### P4-2. 상세 학습 통계 (프리미엄)

| 항목 | 내용 |
|------|------|
| **파트** | FE + BE |
| **수정 파일** | |
| | `front/lib/screens/stats_screen.dart` — 프리미엄 통계 (기억률 그래프 등) |
| | `back/app/routes.py` — 상세 통계 API 추가 (선택적) |
| **변경 내용** | |
| | 1. 기본 통계 (무료): 오늘 복습, 마스터 카드, 스트릭 (P1-2에서 구현) |
| | 2. 프리미엄 통계 (패스 전용): |
| |   - 기억률 추이 그래프 (일별/주별) |
| |   - 과목별 학습 분포 |
| |   - 약점 카드 TOP 10 (오답 빈도 높은 카드) |
| | 3. 프리미엄 영역에 자물쇠 + "시험기간 패스로 해금" |
| **의존성** | P1-2 (기본 통계), P2-3 (결제) |
| **난이도** | 중간 |

---

### P4-3. 오답 노트 자동 생성 (프리미엄)

| 항목 | 내용 |
|------|------|
| **파트** | FE + BE |
| **수정 파일** | |
| | `front/lib/screens/exam_result_screen.dart` — 오답 노트 저장 기능 추가 |
| | `back/app/models.py` — `WrongNoteModel` 테이블 추가 (선택적, 프론트 로컬 저장도 가능) |
| | 신규: `front/lib/screens/wrong_note_screen.dart` — 오답 노트 화면 |
| **변경 내용** | |
| | 1. 시험 결과 화면에서 "오답 노트 저장" 버튼 추가 (패스 전용) |
| | 2. 틀린 카드 자동 수집 -> 별도 세션으로 저장 |
| | 3. 오답 노트 전용 학습 모드 (SRS 복습 우선순위 높임) |
| **의존성** | P4-1 (시험 모드 완성) |
| **난이도** | 중간 |
| **기존 구현 활용** | ExamResultScreen에 이미 `_wrongResults` 리스트 구현. 틀린 카드 재시험 기능도 완성. 저장+별도 화면만 추가 |

---

### P4-4. Google 로그인 구현

| 항목 | 내용 |
|------|------|
| **파트** | BE + FE |
| **수정 파일** | |
| | `back/app/auth.py` — Google OAuth 코드 교환 + 유저 조회/생성 |
| | `back/app/auth_routes.py` — `/auth/google/login`, `/auth/google/callback` 추가 |
| | `back/app/models.py` — UserModel에 `google_id` 필드 추가, `kakao_id` nullable 변경 |
| | `back/app/config.py` — `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET` 추가 |
| | `front/lib/screens/login_screen.dart` — Google 로그인 버튼 실제 동작으로 변경 |
| | `front/lib/config/api_config.dart` — Google 로그인 URL 추가 |
| **변경 내용** | |
| | 1. Google Cloud Console에서 OAuth 2.0 클라이언트 생성 |
| | 2. Google OAuth 플로우 구현 (카카오와 동일한 패턴: 리다이렉트 -> 콜백 -> JWT 발급) |
| | 3. UserModel에 `google_id` 추가, 기존 `kakao_id` unique 제약 조정 |
| | 4. 같은 이메일로 카카오+Google 모두 로그인한 경우 계정 병합 로직 |
| | 5. LoginScreen에서 Google 버튼 목업 -> 실제 동작으로 변경 |
| **의존성** | 없음 (독립 작업) |
| **난이도** | 높음 |
| **주의사항** | |
| | - Android: SHA-1 인증서 지문 등록 필요 |
| | - Web: 리다이렉트 URI 등록 |
| | - 계정 병합 시 데이터 충돌 처리 (세션, 폴더, SRS 기록) |

---

### P4-5. Apple 로그인 구현

| 항목 | 내용 |
|------|------|
| **파트** | BE + FE |
| **수정 파일** | |
| | `back/app/auth.py` — Apple ID Token 검증 |
| | `back/app/auth_routes.py` — `/auth/apple/login`, `/auth/apple/callback` 추가 |
| | `back/app/models.py` — UserModel에 `apple_id` 필드 추가 |
| | `back/app/config.py` — Apple 관련 설정 추가 |
| | `front/lib/screens/login_screen.dart` — Apple 로그인 버튼 실제 동작으로 변경 |
| **변경 내용** | |
| | 1. Apple Developer 계정에서 Sign in with Apple 설정 |
| | 2. Apple OAuth 플로우 구현 (ID Token 기반) |
| | 3. iOS 앱 배포 시 필수 (Apple 정책: 소셜 로그인 있으면 Apple 로그인 필수) |
| **의존성** | P4-4 (Google 로그인과 동일 패턴, UserModel 수정 공유) |
| **난이도** | 높음 |
| **주의사항** | iOS 앱 출시 전까지는 Web만 지원해도 무방 |

---

### P4-6. 시험기간 패스 상품 출시

| 항목 | 내용 |
|------|------|
| **파트** | FE + BE |
| **수정 파일** | |
| | `front/lib/screens/paywall_screen.dart` — 시험기간 패스 상품 활성화 |
| | `back/app/billing_service.py` — 패스 구매 처리 로직 활성화 |
| **변경 내용** | |
| | 1. 결제 화면에서 시험기간 패스 옵션 활성화 (P2-4에서 UI는 만들어 둔 상태) |
| | 2. 구매 시 `pass_expires_at` = now + 30일 설정 |
| | 3. 패스 활성 기간 동안: 무제한 생성 + 시험 모드 + 상세 통계 + 오답 노트 + 무제한 폴더 |
| | 4. 만료 안내: 만료 3일 전 앱 내 배너 |
| **의존성** | P4-1, P4-2, P4-3 (프리미엄 기능 완성) |
| **난이도** | 낮음 (인프라는 P2에서 완성, 활성화만) |

---

### P4-7. 4월 중간고사 시즌 마케팅

| 항목 | 내용 |
|------|------|
| **파트** | 기타 (마케팅) |
| **수행 내용** | |
| | 1. 에브리타임 집중 마케팅 (10~20개 대학) |
| | 2. "시험기간 패스 ₩9,900 — 무제한 생성 + 모의고사" 포지셔닝 |
| | 3. 유저 후기 수집 + 바이럴 콘텐츠 제작 |
| | 4. 리퍼럴 프로그램 시작 (추천인 +2회, 피추천인 +1회) |
| **의존성** | P4-6 (패스 출시) |
| **난이도** | 낮음 |

---

### P4-8. 첫 달 성과 리뷰 + 가격 A/B 테스트

| 항목 | 내용 |
|------|------|
| **파트** | 기타 (분석) |
| **수행 내용** | |
| | 1. W13 기준 핵심 지표 리뷰: MAU, 유료 전환율, ARPU, D7 리텐션 |
| | 2. 가격 A/B 테스트 설계 (스타터 ₩1,100 vs ₩990) |
| | 3. Go/No-Go: 월 매출 > ₩30만 -> 시드 투자 준비 시작 |
| **의존성** | P3 + P4 데이터 축적 |
| **난이도** | 낮음 |

---

### Phase 4 산출물

| 산출물 | 검증 방법 |
|--------|-----------|
| 시험기간 패스로 시험 모드 진입 가능 | 패스 구매 후 시험 모드 접근 |
| 상세 통계 + 오답 노트 동작 | 패스 유저 전용 기능 확인 |
| Google/Apple 로그인 동작 | 각 소셜 로그인 E2E 테스트 |
| 시험기간 패스 판매 1건 이상 | 결제 로그 확인 |
| Go/No-Go: MAU > 200, 유료 > 15명 | W10 기준 측정 |

---

## 전체 타임라인 요약

```
W1          Phase 0: 품질 개선
            ├── P0-1 카드 양 증가 + 품질 검수 시스템
            ├── P0-2 OX형 템플릿 추가
            └── P0-3 개인정보처리방침 + 이용약관

W2~W4       Phase 1: SRS + 핵심 루프
            ├── P1-1 "오늘의 복습" 홈 배너
            ├── P1-2 학습 통계 화면
            ├── P1-3 보관함 -> SRS 복습 연결
            └── P1-4 학습 완료 후 SRS 자동 전환
            [Go/No-Go: D7 리텐션 > 15%]

W5~W6       Phase 2: 결제 인프라
            ├── P2-1 생성 카운터 + 무료 3회 제한 (BE)
            ├── P2-2 잔여 횟수 표시 (FE)
            ├── P2-3 Google Play 인앱결제 연동
            ├── P2-4 페이월 UI + 결제 화면
            └── P2-5 내부 QA

W7~W8       Phase 3: 소프트 런칭
            ├── P3-1 Google Play Store 등록
            ├── P3-2 에브리타임 마케팅
            ├── P3-3 모니터링 + 분석 설정
            └── P3-4 피드백 수집
            [Go/No-Go: 유료 전환율 > 5%]

W9~W13      Phase 4: 시험기간 패스 + 성장
            ├── P4-1 시험 모드 프리미엄 게이트
            ├── P4-2 상세 학습 통계 (프리미엄)
            ├── P4-3 오답 노트 자동 생성
            ├── P4-4 Google 로그인
            ├── P4-5 Apple 로그인
            ├── P4-6 시험기간 패스 출시
            ├── P4-7 4월 중간고사 마케팅
            └── P4-8 성과 리뷰 + A/B 테스트
            [Go/No-Go: 월 매출 > ₩30만]
```

---

## 의존성 그래프

```
P0-1 ──┐
P0-2 ──┼── Phase 0 완료 ──> P1-1 ──> P1-2 ──> P1-3
P0-3 ──┘                    │                    │
                            └──> P1-4            │
                                                 │
                    Phase 1 완료 ──> P2-1 ──> P2-2
                                      │
                                      ├──> P2-3 ──> P2-4 ──> P2-5
                                      │
                          Phase 2 완료 ──> P3-1 ──> P3-2
                                           │
                                           ├──> P3-3
                                           └──> P3-4
                                                 │
                          Phase 3 완료 ──> P4-1 ──> P4-3
                                           │
                                           ├──> P4-2
                                           ├──> P4-4 ──> P4-5
                                           └──> P4-6 ──> P4-7
                                                          │
                                                          └──> P4-8
```

---

## 비용 최적화 우선순위 (모든 Phase에 걸쳐)

| 우선순위 | 작업 | 영향 | 구현 시점 |
|----------|------|------|-----------|
| 1 | Free 유저 Haiku 4.5 적용 | AI 비용 60~70% 절감 | Phase 2 (W5) |
| 2 | 청크 크기 최적화 (5->7~8페이지) | 호출 횟수 30% 감소 | Phase 0 (W1) |
| 3 | CLI -> API 직접 전환 | 메모리 15% 절감 | Phase 3~4 (여유 시) |

### Haiku 적용 방법
- `back/app/config.py` — `LLM_MODEL_FREE` 설정 추가 ("claude-3-5-haiku-20241022")
- `back/app/card_service.py` — `generate_cards()`에 model 파라미터 추가
- `back/app/routes.py` — `generate()`에서 유저 유형별 모델 분기

---

## 리스크 대응 계획

| 리스크 | 확률 | 대응 |
|--------|------|------|
| Phase 0 카드 양 증가 실패 (프롬프트만으로 부족) | 낮음 | CHUNK_SIZE 줄이기, 프롬프트에 "최소 N장" 명시 |
| SRS D7 리텐션 미달 (<15%) | 중간 | 푸시 알림 추가, 복습 리마인더, 감마피케이션 요소 |
| Google Play 심사 반려 | 중간 | 반려 사유 즉시 대응 (보통 2~3일 내 재심사) |
| 인앱결제 구현 지연 | 중간 | 웹 결제(카카오페이/토스페이) 먼저 구현 후 인앱결제 추가 |
| 1인 개발 번아웃 | 중간 | Phase별 Go/No-Go 기준 엄격 적용, No-Go 시 중단 판단 |
